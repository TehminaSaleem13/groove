image: ruby:2.1.6

pipelines:
  default:
    - step:
        name: 'Master Rspec'
        caches:
          - bundler
        services:
          - mysql
          - redis
        script:
          - bundle install
          - bundle exec rake db:create RAILS_ENV=test
          - bundle exec rake db:migrate RAILS_ENV=test
          - RAILS_ENV=test rspec
definitions:
  caches:
    bundler: vendor/bundle
  services:
    redis:
      image: redis:3.2
    mysql:
      image: mysql:5.7
      environment:
        MYSQL_DATABASE: pipelines
        MYSQL_ROOT_PASSWORD: root_user_password
        MYSQL_USER: test_user
        MYSQL_PASSWORD: test_user_password